<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuestras Aventuras üíï</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 20px; color: #666;">
            Cargando... Si esto no desaparece, revisa la consola (F12)
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        console.log('Script iniciando...');

        // Funci√≥n para comprimir im√°genes
        const compressImage = (file, maxWidth = 1200, quality = 0.8) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        // Redimensionar si es necesario
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // Convertir a base64 con compresi√≥n
                        const compressedBase64 = canvas.toDataURL('image/jpeg', quality);
                        resolve(compressedBase64);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };

        // Sistema de storage local con manejo de errores mejorado
        window.storage = {
            data: JSON.parse(localStorage.getItem('travelJournal') || '{}'),
            async get(key) {
                const value = this.data[key];
                return value ? { key, value, shared: false } : null;
            },
            async set(key, value) {
                try {
                    this.data[key] = value;
                    const dataStr = JSON.stringify(this.data);

                    // Verificar tama√±o (localStorage tiene l√≠mite de ~5MB)
                    const sizeInMB = new Blob([dataStr]).size / (1024 * 1024);
                    console.log(`Tama√±o de datos: ${sizeInMB.toFixed(2)} MB`);

                    if (sizeInMB > 4.5) {
                        alert(`‚ö†Ô∏è Advertencia: Los datos est√°n ocupando ${sizeInMB.toFixed(2)} MB. El l√≠mite es ~5MB. Considera eliminar fotos antiguas o reducir la calidad.`);
                    }

                    localStorage.setItem('travelJournal', dataStr);

                    // Verificar que se guard√≥ correctamente
                    const saved = localStorage.getItem('travelJournal');
                    if (!saved) {
                        throw new Error('No se pudo guardar en localStorage');
                    }

                    return { key, value, shared: false };
                } catch (error) {
                    console.error('Error al guardar:', error);
                    if (error.name === 'QuotaExceededError') {
                        alert('‚ùå Error: Espacio de almacenamiento lleno. Las im√°genes son muy grandes. Intenta:\n1. Eliminar algunos viajes o fotos\n2. Exportar tus datos como respaldo\n3. Recargar la p√°gina');
                    } else {
                        alert('‚ùå Error al guardar los datos: ' + error.message);
                    }
                    throw error;
                }
            },
            async delete(key) {
                try {
                    delete this.data[key];
                    localStorage.setItem('travelJournal', JSON.stringify(this.data));
                    return { key, deleted: true, shared: false };
                } catch (error) {
                    console.error('Error al eliminar:', error);
                    alert('‚ùå Error al eliminar datos');
                    throw error;
                }
            },
            async list(prefix) {
                const keys = Object.keys(this.data).filter(k => k.startsWith(prefix || ''));
                return { keys, prefix, shared: false };
            }
        };

        // Iconos SVG
        const Heart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const ArrowLeft = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        );

        const ArrowRight = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
        );

        const Camera = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const MessageCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
            </svg>
        );

        const Edit2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        function TravelJournal() {
            const [trips, setTrips] = useState([]);
            const [currentPage, setCurrentPage] = useState(0);
            const [showNewTrip, setShowNewTrip] = useState(false);
            const [showAddPhoto, setShowAddPhoto] = useState(false);
            const [selectedTripIndex, setSelectedTripIndex] = useState(null);
            const [newTrip, setNewTrip] = useState({ title: '', date: '', location: '', description: '' });
            const [newPhoto, setNewPhoto] = useState({ file: null, url: '', caption: '' });
            const [enlargedPhoto, setEnlargedPhoto] = useState(null);
            const [showEditTrip, setShowEditTrip] = useState(false);
            const [editingTrip, setEditingTrip] = useState(null);
            const [editingPhoto, setEditingPhoto] = useState(null);
            const [showEditPhoto, setShowEditPhoto] = useState(false);

            useEffect(() => {
                console.log('Componente montado, cargando viajes...');
                loadTrips();
            }, []);

            const loadTrips = async () => {
                try {
                    const keys = await window.storage.list('trip:');
                    console.log('Keys encontradas:', keys);
                    if (keys && keys.keys && keys.keys.length > 0) {
                        const loadedTrips = await Promise.all(
                            keys.keys.map(async (key) => {
                                const result = await window.storage.get(key);
                                return result ? JSON.parse(result.value) : null;
                            })
                        );
                        setTrips(loadedTrips.filter(t => t !== null).sort((a, b) => new Date(a.date) - new Date(b.date)));
                    }
                } catch (error) {
                    console.log('Iniciando con viajes vac√≠os:', error);
                }
            };

            const saveTrip = async (trip) => {
                try {
                    await window.storage.set(`trip:${trip.id}`, JSON.stringify(trip));
                    console.log('Viaje guardado:', trip);
                } catch (error) {
                    console.error('Error al guardar:', error);
                }
            };

            const addTrip = async () => {
                if (!newTrip.title || !newTrip.date) {
                    alert('Por favor completa al menos el t√≠tulo y la fecha');
                    return;
                }
                
                const trip = {
                    ...newTrip,
                    id: Date.now().toString(),
                    photos: [],
                    createdAt: new Date().toISOString()
                };
                
                await saveTrip(trip);
                const updatedTrips = [trip, ...trips].sort((a, b) => new Date(a.date) - new Date(b.date));
                setTrips(updatedTrips);
                setNewTrip({ title: '', date: '', location: '', description: '' });
                setShowNewTrip(false);
                // Encontrar la posici√≥n del nuevo viaje para mostrarla
                const newTripIndex = updatedTrips.findIndex(t => t.id === trip.id);
                setCurrentPage(newTripIndex);
            };

            const deleteTrip = async (index) => {
                if (!window.confirm('¬øSeguro que quieres eliminar este viaje?')) return;
                
                const trip = trips[index];
                try {
                    await window.storage.delete(`trip:${trip.id}`);
                    const newTrips = trips.filter((_, i) => i !== index);
                    setTrips(newTrips);
                    if (currentPage >= newTrips.length && newTrips.length > 0) {
                        setCurrentPage(newTrips.length - 1);
                    } else if (newTrips.length === 0) {
                        setCurrentPage(0);
                    }
                } catch (error) {
                    console.error('Error al eliminar:', error);
                }
            };

            const addPhoto = async () => {
                if (!newPhoto.file || selectedTripIndex === null) {
                    alert('Por favor selecciona una imagen');
                    return;
                }

                try {
                    // Comprimir la imagen antes de guardar
                    const compressedBase64 = await compressImage(newPhoto.file);

                    const updatedTrips = [...trips];
                    const photo = {
                        id: Date.now().toString(),
                        url: compressedBase64, // Base64 comprimido
                        caption: newPhoto.caption
                    };

                    updatedTrips[selectedTripIndex].photos.push(photo);
                    await saveTrip(updatedTrips[selectedTripIndex]);
                    setTrips(updatedTrips);
                    setNewPhoto({ file: null, url: '', caption: '' });
                    setShowAddPhoto(false);
                    setSelectedTripIndex(null);
                    alert('‚úÖ Foto agregada exitosamente');
                } catch (error) {
                    console.error('Error al agregar foto:', error);
                    alert('‚ùå Error al agregar la foto. Por favor intenta de nuevo.');
                }
            };

            const deletePhoto = async (tripIndex, photoId) => {
                const updatedTrips = [...trips];
                updatedTrips[tripIndex].photos = updatedTrips[tripIndex].photos.filter(p => p.id !== photoId);
                await saveTrip(updatedTrips[tripIndex]);
                setTrips(updatedTrips);
            };

            const openEditTrip = (tripIndex) => {
                setEditingTrip({...trips[tripIndex]});
                setShowEditTrip(true);
            };

            const saveEditTrip = async () => {
                if (!editingTrip.title || !editingTrip.date) {
                    alert('Por favor completa al menos el t√≠tulo y la fecha');
                    return;
                }

                const updatedTrips = [...trips];
                const tripIndex = updatedTrips.findIndex(t => t.id === editingTrip.id);
                updatedTrips[tripIndex] = editingTrip;

                // Reordenar por fecha despu√©s de editar
                const sortedTrips = updatedTrips.sort((a, b) => new Date(a.date) - new Date(b.date));

                await saveTrip(editingTrip);
                setTrips(sortedTrips);

                // Actualizar la p√°gina actual a la nueva posici√≥n del viaje editado
                const newTripIndex = sortedTrips.findIndex(t => t.id === editingTrip.id);
                setCurrentPage(newTripIndex);

                setShowEditTrip(false);
                setEditingTrip(null);
            };

            const openEditPhoto = (photo, tripIndex) => {
                setEditingPhoto({...photo, tripIndex});
                setShowEditPhoto(true);
            };

            const saveEditPhoto = async () => {
                const updatedTrips = [...trips];
                const photoIndex = updatedTrips[editingPhoto.tripIndex].photos.findIndex(p => p.id === editingPhoto.id);
                updatedTrips[editingPhoto.tripIndex].photos[photoIndex].caption = editingPhoto.caption;

                await saveTrip(updatedTrips[editingPhoto.tripIndex]);
                setTrips(updatedTrips);
                setShowEditPhoto(false);
                setEditingPhoto(null);
            };

            const exportData = () => {
                try {
                    const dataStr = localStorage.getItem('travelJournal');
                    if (!dataStr) {
                        alert('No hay datos para exportar');
                        return;
                    }

                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `viajes-respaldo-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    alert('‚úÖ Datos exportados exitosamente. Guarda este archivo en un lugar seguro.');
                } catch (error) {
                    console.error('Error al exportar:', error);
                    alert('‚ùå Error al exportar datos');
                }
            };

            const importData = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = async (e) => {
                    try {
                        const file = e.target.files[0];
                        if (!file) return;

                        const text = await file.text();
                        const data = JSON.parse(text);

                        if (!window.confirm('‚ö†Ô∏è Esto sobrescribir√° todos tus datos actuales. ¬øContinuar?')) {
                            return;
                        }

                        localStorage.setItem('travelJournal', text);
                        window.storage.data = data;
                        await loadTrips();
                        alert('‚úÖ Datos importados exitosamente. Recarga la p√°gina para ver los cambios.');
                        window.location.reload();
                    } catch (error) {
                        console.error('Error al importar:', error);
                        alert('‚ùå Error al importar datos. Verifica que el archivo sea v√°lido.');
                    }
                };
                input.click();
            };

            const nextPage = () => {
                if (currentPage < trips.length - 1) setCurrentPage(currentPage + 1);
            };

            const prevPage = () => {
                if (currentPage > 0) setCurrentPage(currentPage - 1);
            };

            return (
                <div style={{minHeight: '100vh', background: 'linear-gradient(to bottom right, #fce7f3, #f3e8ff, #dbeafe)', padding: '1rem'}}>
                    <div style={{maxWidth: '64rem', margin: '0 auto'}}>
                        <div style={{textAlign: 'center', marginBottom: '2rem', paddingTop: '1.5rem'}}>
                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem', marginBottom: '0.5rem'}}>
                                <Heart size={32} className="text-red-500 fill-red-500 animate-pulse" />
                                <h1 style={{fontSize: '2.25rem', fontWeight: 'bold', background: 'linear-gradient(to right, #db2777, #9333ea)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', backgroundClip: 'text'}}>
                                    Nuestras Aventuras
                                </h1>
                                <Heart size={32} className="text-red-500 fill-red-500 animate-pulse" />
                            </div>
                            <p style={{color: '#4b5563', fontSize: '1.125rem'}}>2 a√±os de amor y recuerdos üíë</p>
                            <div style={{display: 'flex', justifyContent: 'center', gap: '1rem', marginTop: '1rem'}}>
                                <button
                                    onClick={exportData}
                                    style={{color: '#6b7280', fontSize: '0.875rem', background: 'none', border: '1px solid #d1d5db', borderRadius: '0.5rem', padding: '0.5rem 1rem', cursor: 'pointer', transition: 'all 0.2s'}}
                                    onMouseOver={(e) => {e.target.style.backgroundColor = '#f3f4f6'; e.target.style.borderColor = '#9ca3af';}}
                                    onMouseOut={(e) => {e.target.style.backgroundColor = 'transparent'; e.target.style.borderColor = '#d1d5db';}}
                                    title="Exportar todos los datos como respaldo"
                                >
                                    üì• Exportar Respaldo
                                </button>
                                <button
                                    onClick={importData}
                                    style={{color: '#6b7280', fontSize: '0.875rem', background: 'none', border: '1px solid #d1d5db', borderRadius: '0.5rem', padding: '0.5rem 1rem', cursor: 'pointer', transition: 'all 0.2s'}}
                                    onMouseOver={(e) => {e.target.style.backgroundColor = '#f3f4f6'; e.target.style.borderColor = '#9ca3af';}}
                                    onMouseOut={(e) => {e.target.style.backgroundColor = 'transparent'; e.target.style.borderColor = '#d1d5db';}}
                                    title="Importar datos desde un archivo de respaldo"
                                >
                                    üì§ Importar Respaldo
                                </button>
                            </div>
                        </div>

                        <div style={{display: 'flex', justifyContent: 'center', marginBottom: '1.5rem'}}>
                            <button
                                onClick={() => setShowNewTrip(true)}
                                style={{background: 'linear-gradient(to right, #ec4899, #a855f7)', color: 'white', padding: '0.75rem 1.5rem', borderRadius: '9999px', display: 'flex', alignItems: 'center', gap: '0.5rem', border: 'none', cursor: 'pointer', fontSize: '1rem', boxShadow: '0 4px 6px rgba(0,0,0,0.1)', transition: 'all 0.3s'}}
                                onMouseOver={(e) => e.target.style.transform = 'scale(1.05)'}
                                onMouseOut={(e) => e.target.style.transform = 'scale(1)'}
                            >
                                <Plus size={20} />
                                Agregar Nuevo Viaje
                            </button>
                        </div>

                        {showNewTrip && (
                            <div style={{position: 'fixed', inset: 0, backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem', zIndex: 50}}>
                                <div style={{backgroundColor: 'white', borderRadius: '1rem', padding: '1.5rem', maxWidth: '28rem', width: '100%', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                        <h2 style={{fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937', margin: 0}}>Nuevo Viaje</h2>
                                        <button onClick={() => setShowNewTrip(false)} style={{color: '#6b7280', background: 'none', border: 'none', cursor: 'pointer', padding: '0.25rem'}}>
                                            <X size={24} />
                                        </button>
                                    </div>
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                                        <input
                                            type="text"
                                            placeholder="T√≠tulo del viaje *"
                                            value={newTrip.title}
                                            onChange={(e) => setNewTrip({...newTrip, title: e.target.value})}
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box'}}
                                        />
                                        <input
                                            type="date"
                                            value={newTrip.date}
                                            onChange={(e) => setNewTrip({...newTrip, date: e.target.value})}
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box'}}
                                        />
                                        <input
                                            type="text"
                                            placeholder="Lugar"
                                            value={newTrip.location}
                                            onChange={(e) => setNewTrip({...newTrip, location: e.target.value})}
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box'}}
                                        />
                                        <textarea
                                            placeholder="Descripci√≥n del viaje"
                                            value={newTrip.description}
                                            onChange={(e) => setNewTrip({...newTrip, description: e.target.value})}
                                            rows="3"
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box', resize: 'vertical'}}
                                        />
                                        <button
                                            onClick={addTrip}
                                            style={{width: '100%', background: 'linear-gradient(to right, #ec4899, #a855f7)', color: 'white', padding: '0.75rem', borderRadius: '0.5rem', border: 'none', cursor: 'pointer', fontSize: '1rem', fontWeight: '600'}}
                                        >
                                            Guardar Viaje
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showAddPhoto && (
                            <div style={{position: 'fixed', inset: 0, backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem', zIndex: 50}}>
                                <div style={{backgroundColor: 'white', borderRadius: '1rem', padding: '1.5rem', maxWidth: '28rem', width: '100%', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                        <h2 style={{fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937', margin: 0}}>Agregar Foto</h2>
                                        <button onClick={() => {setShowAddPhoto(false); setSelectedTripIndex(null);}} style={{color: '#6b7280', background: 'none', border: 'none', cursor: 'pointer', padding: '0.25rem'}}>
                                            <X size={24} />
                                        </button>
                                    </div>
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                                        <div>
                                            <label style={{display: 'block', marginBottom: '0.5rem', color: '#4b5563', fontSize: '0.875rem', fontWeight: '500'}}>
                                                Selecciona una imagen *
                                            </label>
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={async (e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        try {
                                                            const compressed = await compressImage(file);
                                                            setNewPhoto({...newPhoto, file: file, url: compressed});
                                                        } catch (error) {
                                                            console.error('Error al procesar imagen:', error);
                                                            alert('‚ùå Error al procesar la imagen');
                                                        }
                                                    }
                                                }}
                                                style={{width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box'}}
                                            />
                                            {newPhoto.url && (
                                                <div style={{marginTop: '0.75rem'}}>
                                                    <img
                                                        src={newPhoto.url}
                                                        alt="Vista previa"
                                                        style={{width: '100%', maxHeight: '200px', objectFit: 'contain', borderRadius: '0.5rem', border: '2px solid #e5e7eb'}}
                                                    />
                                                </div>
                                            )}
                                        </div>
                                        <textarea
                                            placeholder="Comentario sobre la foto"
                                            value={newPhoto.caption}
                                            onChange={(e) => setNewPhoto({...newPhoto, caption: e.target.value})}
                                            rows="2"
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box', resize: 'vertical'}}
                                        />
                                        <button
                                            onClick={addPhoto}
                                            style={{width: '100%', background: 'linear-gradient(to right, #ec4899, #a855f7)', color: 'white', padding: '0.75rem', borderRadius: '0.5rem', border: 'none', cursor: 'pointer', fontSize: '1rem', fontWeight: '600'}}
                                        >
                                            Agregar Foto
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showEditTrip && editingTrip && (
                            <div style={{position: 'fixed', inset: 0, backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem', zIndex: 50}}>
                                <div style={{backgroundColor: 'white', borderRadius: '1rem', padding: '1.5rem', maxWidth: '28rem', width: '100%', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                        <h2 style={{fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937', margin: 0}}>Editar Viaje</h2>
                                        <button onClick={() => {setShowEditTrip(false); setEditingTrip(null);}} style={{color: '#6b7280', background: 'none', border: 'none', cursor: 'pointer', padding: '0.25rem'}}>
                                            <X size={24} />
                                        </button>
                                    </div>
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                                        <input
                                            type="text"
                                            placeholder="T√≠tulo del viaje *"
                                            value={editingTrip.title}
                                            onChange={(e) => setEditingTrip({...editingTrip, title: e.target.value})}
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box'}}
                                        />
                                        <input
                                            type="date"
                                            value={editingTrip.date}
                                            onChange={(e) => setEditingTrip({...editingTrip, date: e.target.value})}
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box'}}
                                        />
                                        <input
                                            type="text"
                                            placeholder="Lugar"
                                            value={editingTrip.location}
                                            onChange={(e) => setEditingTrip({...editingTrip, location: e.target.value})}
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box'}}
                                        />
                                        <textarea
                                            placeholder="Descripci√≥n del viaje"
                                            value={editingTrip.description}
                                            onChange={(e) => setEditingTrip({...editingTrip, description: e.target.value})}
                                            rows="3"
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box', resize: 'vertical'}}
                                        />
                                        <button
                                            onClick={saveEditTrip}
                                            style={{width: '100%', background: 'linear-gradient(to right, #ec4899, #a855f7)', color: 'white', padding: '0.75rem', borderRadius: '0.5rem', border: 'none', cursor: 'pointer', fontSize: '1rem', fontWeight: '600'}}
                                        >
                                            Guardar Cambios
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showEditPhoto && editingPhoto && (
                            <div style={{position: 'fixed', inset: 0, backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem', zIndex: 50}}>
                                <div style={{backgroundColor: 'white', borderRadius: '1rem', padding: '1.5rem', maxWidth: '28rem', width: '100%', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                        <h2 style={{fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937', margin: 0}}>Editar Nota</h2>
                                        <button onClick={() => {setShowEditPhoto(false); setEditingPhoto(null);}} style={{color: '#6b7280', background: 'none', border: 'none', cursor: 'pointer', padding: '0.25rem'}}>
                                            <X size={24} />
                                        </button>
                                    </div>
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                                        <img
                                            src={editingPhoto.url}
                                            alt="Vista previa"
                                            style={{width: '100%', maxHeight: '200px', objectFit: 'contain', borderRadius: '0.5rem', border: '2px solid #e5e7eb'}}
                                        />
                                        <textarea
                                            placeholder="Comentario sobre la foto"
                                            value={editingPhoto.caption || ''}
                                            onChange={(e) => setEditingPhoto({...editingPhoto, caption: e.target.value})}
                                            rows="3"
                                            style={{width: '100%', padding: '0.5rem 1rem', border: '1px solid #d1d5db', borderRadius: '0.5rem', fontSize: '1rem', boxSizing: 'border-box', resize: 'vertical'}}
                                        />
                                        <button
                                            onClick={saveEditPhoto}
                                            style={{width: '100%', background: 'linear-gradient(to right, #ec4899, #a855f7)', color: 'white', padding: '0.75rem', borderRadius: '0.5rem', border: 'none', cursor: 'pointer', fontSize: '1rem', fontWeight: '600'}}
                                        >
                                            Guardar Nota
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {enlargedPhoto && (
                            <div
                                style={{position: 'fixed', inset: 0, backgroundColor: 'rgba(0,0,0,0.9)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem', zIndex: 100}}
                                onClick={() => setEnlargedPhoto(null)}
                            >
                                <div style={{position: 'relative', maxWidth: '90vw', maxHeight: '90vh', display: 'flex', flexDirection: 'column', alignItems: 'center'}}>
                                    <button
                                        onClick={() => setEnlargedPhoto(null)}
                                        style={{position: 'absolute', top: '-2.5rem', right: '0', color: 'white', background: 'rgba(255,255,255,0.2)', border: 'none', cursor: 'pointer', padding: '0.5rem', borderRadius: '9999px', display: 'flex', alignItems: 'center', justifyContent: 'center'}}
                                    >
                                        <X size={24} />
                                    </button>
                                    <img
                                        src={enlargedPhoto.url}
                                        alt={enlargedPhoto.caption || 'Foto ampliada'}
                                        style={{maxWidth: '100%', maxHeight: '90vh', objectFit: 'contain', borderRadius: '0.5rem', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.5)'}}
                                        onClick={(e) => e.stopPropagation()}
                                    />
                                    {enlargedPhoto.caption && (
                                        <div style={{backgroundColor: 'rgba(0,0,0,0.7)', color: 'white', padding: '1rem', borderRadius: '0.5rem', marginTop: '1rem', maxWidth: '600px', textAlign: 'center'}}>
                                            {enlargedPhoto.caption}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {trips.length === 0 ? (
                            <div style={{textAlign: 'center', padding: '5rem 0'}}>
                                <Camera size={64} style={{margin: '0 auto 1rem', color: '#d1d5db'}} />
                                <p style={{color: '#6b7280', fontSize: '1.125rem', marginBottom: '0.5rem'}}>A√∫n no hay viajes registrados</p>
                                <p style={{color: '#9ca3af'}}>¬°Comienza agregando tu primera aventura juntos!</p>
                            </div>
                        ) : (
                            <div style={{position: 'relative'}}>
                                <div style={{backgroundColor: 'white', borderRadius: '1rem', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)', padding: '2rem', minHeight: '600px', border: '4px solid #e9d5ff'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1.5rem'}}>
                                        <div style={{flex: 1}}>
                                            <h2 style={{fontSize: '1.875rem', fontWeight: 'bold', color: '#1f2937', marginBottom: '0.5rem'}}>{trips[currentPage].title}</h2>
                                            <div style={{display: 'flex', gap: '1rem', color: '#4b5563', marginBottom: '1rem', flexWrap: 'wrap'}}>
                                                <span>üìÖ {new Date(trips[currentPage].date).toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
                                                {trips[currentPage].location && <span>üìç {trips[currentPage].location}</span>}
                                            </div>
                                        </div>
                                        <div style={{display: 'flex', gap: '0.5rem'}}>
                                            <button
                                                onClick={() => openEditTrip(currentPage)}
                                                style={{color: '#8b5cf6', background: 'none', border: 'none', cursor: 'pointer', padding: '0.5rem'}}
                                                title="Editar viaje"
                                            >
                                                <Edit2 size={20} />
                                            </button>
                                            <button
                                                onClick={() => deleteTrip(currentPage)}
                                                style={{color: '#ef4444', background: 'none', border: 'none', cursor: 'pointer', padding: '0.5rem'}}
                                                title="Eliminar viaje"
                                            >
                                                <Trash2 size={20} />
                                            </button>
                                        </div>
                                    </div>

                                    {trips[currentPage].description && (
                                        <p style={{color: '#374151', marginBottom: '1.5rem', fontSize: '1.125rem', lineHeight: '1.75'}}>{trips[currentPage].description}</p>
                                    )}

                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))', gap: '1rem', marginBottom: '1.5rem'}}>
                                        {trips[currentPage].photos.map((photo) => (
                                            <div key={photo.id} style={{position: 'relative'}} className="photo-container">
                                                <img
                                                    src={photo.url}
                                                    alt={photo.caption || 'Foto de viaje'}
                                                    style={{width: '100%', height: '12rem', objectFit: 'cover', borderRadius: '0.5rem', boxShadow: '0 4px 6px rgba(0,0,0,0.1)', cursor: 'pointer'}}
                                                    onClick={() => setEnlargedPhoto(photo)}
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                        e.target.nextSibling.style.display = 'flex';
                                                    }}
                                                />
                                                <div style={{width: '100%', height: '12rem', backgroundColor: '#f3f4f6', borderRadius: '0.5rem', display: 'none', alignItems: 'center', justifyContent: 'center', color: '#9ca3af', fontSize: '0.875rem'}}>
                                                    Imagen no disponible
                                                </div>
                                                <div className="photo-actions" style={{position: 'absolute', top: '0.5rem', right: '0.5rem', display: 'flex', gap: '0.5rem', opacity: 0, transition: 'opacity 0.3s'}}>
                                                    <button
                                                        onClick={(e) => {e.stopPropagation(); openEditPhoto(photo, currentPage);}}
                                                        style={{backgroundColor: '#8b5cf6', color: 'white', padding: '0.5rem', borderRadius: '9999px', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'}}
                                                        title="Editar nota"
                                                    >
                                                        <Edit2 size={16} />
                                                    </button>
                                                    <button
                                                        onClick={(e) => {e.stopPropagation(); deletePhoto(currentPage, photo.id);}}
                                                        style={{backgroundColor: '#ef4444', color: 'white', padding: '0.5rem', borderRadius: '9999px', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'}}
                                                        title="Eliminar foto"
                                                    >
                                                        <Trash2 size={16} />
                                                    </button>
                                                </div>
                                                {photo.caption && (
                                                    <div style={{marginTop: '0.5rem', display: 'flex', alignItems: 'flex-start', gap: '0.25rem', fontSize: '0.875rem', color: '#4b5563'}}>
                                                        <MessageCircle size={16} style={{flexShrink: 0, marginTop: '0.125rem'}} />
                                                        <p style={{flex: 1, margin: 0}}>{photo.caption}</p>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>

                                    <button
                                        onClick={() => {setShowAddPhoto(true); setSelectedTripIndex(currentPage);}}
                                        style={{display: 'flex', alignItems: 'center', gap: '0.5rem', color: '#9333ea', border: '2px dashed #d8b4fe', borderRadius: '0.5rem', padding: '0.75rem 1rem', width: '100%', justifyContent: 'center', background: 'none', cursor: 'pointer', fontSize: '1rem', transition: 'all 0.3s'}}
                                        onMouseOver={(e) => e.target.style.backgroundColor = '#faf5ff'}
                                        onMouseOut={(e) => e.target.style.backgroundColor = 'transparent'}
                                    >
                                        <Camera size={20} />
                                        Agregar Foto
                                    </button>

                                    <div style={{textAlign: 'center', marginTop: '1.5rem', color: '#6b7280', fontSize: '0.875rem'}}>
                                        P√°gina {currentPage + 1} de {trips.length}
                                    </div>
                                </div>

                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '1.5rem'}}>
                                    <button
                                        onClick={prevPage}
                                        disabled={currentPage === 0}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.5rem',
                                            padding: '0.75rem 1.5rem',
                                            borderRadius: '9999px',
                                            background: currentPage === 0 ? '#e5e7eb' : 'linear-gradient(to right, #a855f7, #ec4899)',
                                            color: currentPage === 0 ? '#9ca3af' : 'white',
                                            border: 'none',
                                            cursor: currentPage === 0 ? 'not-allowed' : 'pointer',
                                            fontSize: '1rem',
                                            transition: 'all 0.3s'
                                        }}
                                    >
                                        <ArrowLeft size={20} />
                                        Anterior
                                    </button>
                                    <button
                                        onClick={nextPage}
                                        disabled={currentPage === trips.length - 1}
                                        style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.5rem',
                                            padding: '0.75rem 1.5rem',
                                            borderRadius: '9999px',
                                            background: currentPage === trips.length - 1 ? '#e5e7eb' : 'linear-gradient(to right, #ec4899, #a855f7)',
                                            color: currentPage === trips.length - 1 ? '#9ca3af' : 'white',
                                            border: 'none',
                                            cursor: currentPage === trips.length - 1 ? 'not-allowed' : 'pointer',
                                            fontSize: '1rem',
                                            transition: 'all 0.3s'
                                        }}
                                    >
                                        Siguiente
                                        <ArrowRight size={20} />
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                    <style>{`
                        .photo-container:hover .photo-actions {
                            opacity: 1;
                        }
                    `}</style>
                </div>
            );
        }

        console.log('Renderizando aplicaci√≥n...');
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TravelJournal />);
    </script>
</body>
</html>